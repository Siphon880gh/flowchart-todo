<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Flowchart with Checkboxes - Teamspace</title>
    <style>
        #svg-container {
          width:100%;
          height:100%;
          overflow: visible;
        }
        #svg-container, svg {
            position: relative;
            z-index: 1;
        }
        #svg-container svg {
          width:100%;
          height:100%;
          overflow: visible;
        }
        .svg-checkbox {
            position: absolute;
            z-index: 2;
        }
  </style>
</head>
<body>
    <div style="display:block; top:0; left:0;"><button data-svg-zoomer>Zoom</button></div>
    <!-- TOOLER: Add "data-checkbox" attribute to svg children you want to have floating checkboxes that your team ticks -->
    <!-- TOOLER: If want zoom feature to work, make sure sure to remove width and height attributes
                 and set the pixels in the viewBox attribute in this format: "0 0 width height"
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 430 320" preserveAspectRatio="xMidYMid meet">
    -->
    <div id="svg-container">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 430 320" preserveAspectRatio="xMidYMid meet">
            <!-- Rectangle (Start) -->
            <rect x="50" y="20" width="120" height="40" fill="lightblue" stroke="black" data-checkbox />
            <text x="110" y="45" text-anchor="middle" font-size="14" fill="black">Start</text>
            
            <!-- Arrow (Start to Process) -->
            <path d="M110,60 L110,100" stroke="black" marker-end="url(#arrowhead)" />
            
            <!-- Rectangle (Process) -->
            <rect x="50" y="100" width="120" height="40" fill="lightgreen" stroke="black" data-checkbox />
            <text x="110" y="125" text-anchor="middle" font-size="14" fill="black">Process</text>
            
            <!-- Arrow (Process to Decision) -->
            <path d="M110,140 L110,180" stroke="black" marker-end="url(#arrowhead)" />
            
            <!-- Diamond (Decision) -->
            <polygon points="110,200 140,220 110,240 80,220" fill="lightyellow" stroke="black" data-checkbox />
            <text x="110" y="225" text-anchor="middle" font-size="14" fill="black">Decision</text>
            
            <!-- Arrow (Decision to End) -->
            <path d="M140,220 L200,220" stroke="black" marker-end="url(#arrowhead)"/>
            
            <!-- Rectangle (End) -->
            <rect x="200" y="200" width="120" height="40" fill="lightcoral" stroke="black" data-checkbox />
            <text x="260" y="225" text-anchor="middle" font-size="14" fill="black">End</text>
            
            <!-- Arrowhead definition -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="black" />
                </marker>
            </defs>
        </svg>
    </div> <!-- .svg-container -->

    <script>
        const App = {
            init: function() {
              this.initZoom()
              
              this.initRepainters();
              this.attachCheckboxes();
            },
            _zoomFactor: -1,
            initZoom: function() {
              document.querySelector('[data-svg-zoomer]')?.addEventListener('click', ()=>{
                this._zoomFactor += 1;
                switch((this._zoomFactor+1)%8) {
                  case 1: document.querySelector("#svg-container svg").style.width = "125%"; break;
                  case 2: document.querySelector("#svg-container svg").style.width = "150%"; break;
                  case 3: document.querySelector("#svg-container svg").style.width = "175%"; break;
                  case 4: document.querySelector("#svg-container svg").style.width = "200%"; break;
                  case 5: document.querySelector("#svg-container svg").style.width = "50%"; break;
                  case 6: document.querySelector("#svg-container svg").style.width = "75%"; break;
                  case 7: document.querySelector("#svg-container svg").style.width = "100%"; break;
                }
                window.dispatchEvent(new Event('resize'));
              });
            },
            attachCheckboxes: function() {
                const svg = document.getElementsByTagName('svg')[0];
                const svgContainer = document.getElementById('svg-container');
                const svgDrawings = svg.querySelectorAll('[data-checkbox]');
                svgDrawings.forEach(svgDrawing => {
                    // const bbox = element.getBBox(); // can be inaccurate even after render
                    const bbox = svgDrawing?.getBoundingClientRect ? svgDrawing.getBoundingClientRect() : svgDrawing.getBBox();
                    if(!bbox) {
                      console.error("Could not get bounding box for SVG element", {svgDrawing})
                      return
                    }
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.classList.add('svg-checkbox');
                    checkbox.setAttribute('paired', svgDrawing.getAttribute("paired")); // <input... paired="0">
                    checkbox.style.left = `${bbox.x-8}px`;
                    checkbox.style.top = `${bbox.y-8}px`;
                    svgContainer.appendChild(checkbox);
                });
            },
            initRepainters: function() {

                // Assign unique child classes to each SVG child element
                // This is to pair the checkbox with the SVG element
                // So when you resize the window, the checkbox moves with the SVG element
                const svg = document.getElementsByTagName('svg')[0];
                const svgDrawings = svg.querySelectorAll('[data-checkbox]');
                for(var i = 0; i<svgDrawings.length; i++) {
                    var svgDrawing = svgDrawings[i];
                    svgDrawing.setAttribute(`paired`, i); // // <rect... paired="0">
                }
                
                window.addEventListener("resize", (event)=>{
                  console.log("resized")
                    const checkboxes = document.querySelectorAll('.svg-checkbox');
                    console.log("resize->reposition checkbox", {checkboxes})
                    checkboxes.forEach(checkbox => {
                      var pairIndex = checkbox.getAttribute("paired");
                      console.log("resize->reposition checkbox", {pairIndex})
                      var pairedSvgDrawing = document.querySelector(`[paired="${pairIndex}"]:not(input)`);
                      // var bbox = pairedSvgDrawing.getBoundingClientRect();
                      const bbox = pairedSvgDrawing?.getBoundingClientRect ? pairedSvgDrawing.getBoundingClientRect() : pairedSvgDrawing.getBBox();
                      checkbox.style.left = `${bbox.x-8}px`;
                      checkbox.style.top = `${bbox.y-8}px`;
                    });
                })
            },
        }; // App

        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>
